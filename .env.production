# Anthias SaaS Platform - Production Environment Configuration
# SECURITY WARNING: This file contains sensitive production settings
# Ensure proper access controls and never commit to version control

# ==============================================================================
# ENVIRONMENT SETTINGS
# ==============================================================================

ENVIRONMENT=production
DEBUG=false

# Application Information
APP_NAME=Anthias SaaS Platform
APP_VERSION=1.0.0
SECRET_KEY=${SECRET_KEY}  # Set via environment or secrets management

# Server Configuration
LISTEN_HOST=0.0.0.0
LISTEN_PORT=8000
ALLOWED_HOSTS=${ALLOWED_HOSTS}  # Set to your domain(s)

# ==============================================================================
# DATABASE CONFIGURATION
# ==============================================================================

# PostgreSQL Production Configuration
POSTGRES_DB=${POSTGRES_DB:-anthias_production}
POSTGRES_USER=${POSTGRES_USER:-anthias}
POSTGRES_PASSWORD=${POSTGRES_PASSWORD}  # Set via secrets management
POSTGRES_HOST=${POSTGRES_HOST:-postgres}
POSTGRES_PORT=${POSTGRES_PORT:-5432}

# Database URL
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}

# Database Pool Settings (Production Optimized)
DB_POOL_SIZE=25
DB_MAX_OVERFLOW=15
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# Multi-tenant Configuration
TENANT_SCHEMAS_ENABLED=true
SHARED_SCHEMA_NAME=shared
TENANT_SCHEMA_PREFIX=tenant_

# ==============================================================================
# REDIS CONFIGURATION
# ==============================================================================

# Redis Connection
REDIS_HOST=${REDIS_HOST:-redis}
REDIS_PORT=${REDIS_PORT:-6379}
REDIS_PASSWORD=${REDIS_PASSWORD}  # Set if Redis AUTH is enabled
REDIS_URL=redis://${REDIS_HOST}:${REDIS_PORT}/0

# Redis Memory Management
REDIS_MAX_MEMORY=1gb
REDIS_MAX_MEMORY_POLICY=allkeys-lru

# Redis Persistence
REDIS_SAVE_ENABLED=true
REDIS_AOF_ENABLED=true

# ==============================================================================
# CELERY CONFIGURATION
# ==============================================================================

# Celery Broker & Result Backend
CELERY_BROKER_URL=redis://${REDIS_HOST}:${REDIS_PORT}/0
CELERY_RESULT_BACKEND=redis://${REDIS_HOST}:${REDIS_PORT}/1

# Celery Worker Settings (Production Optimized)
CELERY_WORKER_CONCURRENCY=4
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000
CELERY_WORKER_PREFETCH_MULTIPLIER=1

# Celery Serialization
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=json

# Celery Logging
CELERY_LOG_LEVEL=INFO
CELERY_HIJACK_ROOT_LOGGER=false

# ==============================================================================
# SECURITY SETTINGS (PRODUCTION)
# ==============================================================================

# HTTPS Security
SECURE_SSL_REDIRECT=true
SECURE_HSTS_SECONDS=31536000
SECURE_HSTS_INCLUDE_SUBDOMAINS=true
SECURE_HSTS_PRELOAD=true
SECURE_CONTENT_TYPE_NOSNIFF=true
SECURE_BROWSER_XSS_FILTER=true
SECURE_REFERRER_POLICY=strict-origin-when-cross-origin

# Session Security
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=Strict
SESSION_COOKIE_AGE=1209600   # 2 weeks

# CSRF Security
CSRF_COOKIE_SECURE=true
CSRF_COOKIE_HTTPONLY=true
CSRF_COOKIE_SAMESITE=Strict
CSRF_TRUSTED_ORIGINS=${CSRF_TRUSTED_ORIGINS}  # Set to your domain(s)

# CORS Settings (Production Restricted)
CORS_ALLOW_ALL_ORIGINS=false
CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS}  # Set to your domain(s)
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_HEADERS=accept,accept-encoding,authorization,content-type,dnt,origin,user-agent,x-csrftoken,x-requested-with

# ==============================================================================
# SSL/TLS CONFIGURATION
# ==============================================================================

# SSL Certificate Configuration
SSL_DOMAINS=${SSL_DOMAINS}  # Set to your domain(s)
SSL_EMAIL=${SSL_EMAIL}      # Set for Let's Encrypt
SERVER_NAME=${SERVER_NAME}  # Primary domain

# SSL Paths
SSL_CERT_PATH=/etc/ssl/certs
SSL_KEY_PATH=/etc/ssl/private

# Nginx SSL Configuration
NGINX_HOST=${NGINX_HOST:-0.0.0.0}
NGINX_PORT=80
NGINX_SSL_PORT=443

# ==============================================================================
# MEDIA & STATIC FILES
# ==============================================================================

# File Storage Paths
MEDIA_ROOT=/data/media
STATIC_ROOT=/data/static
STATIC_URL=/static/
MEDIA_URL=/media/

# File Upload Settings (Production Limits)
FILE_UPLOAD_MAX_MEMORY_SIZE=52428800   # 50MB
DATA_UPLOAD_MAX_MEMORY_SIZE=52428800   # 50MB
DATA_UPLOAD_MAX_NUMBER_FIELDS=1000

# Content Storage
CONTENT_STORAGE_PATH=/data/content
CONTENT_MAX_FILE_SIZE=536870912  # 512MB
CONTENT_ALLOWED_TYPES=image/jpeg,image/png,image/gif,video/mp4,video/webm,text/html

# ==============================================================================
# AUTHENTICATION & AUTHORIZATION
# ==============================================================================

# JWT Settings
JWT_SECRET_KEY=${SECRET_KEY}
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_LIFETIME=3600      # 1 hour
JWT_REFRESH_TOKEN_LIFETIME=604800   # 1 week

# OAuth Settings (Optional)
GOOGLE_OAUTH_CLIENT_ID=${GOOGLE_OAUTH_CLIENT_ID}
GOOGLE_OAUTH_CLIENT_SECRET=${GOOGLE_OAUTH_CLIENT_SECRET}
MICROSOFT_OAUTH_CLIENT_ID=${MICROSOFT_OAUTH_CLIENT_ID}
MICROSOFT_OAUTH_CLIENT_SECRET=${MICROSOFT_OAUTH_CLIENT_SECRET}

# Multi-tenant Authentication
TENANT_AUTH_ENABLED=true
TENANT_USER_ISOLATION=true

# ==============================================================================
# EMAIL CONFIGURATION
# ==============================================================================

# Email Backend
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend

# SMTP Configuration (Production)
EMAIL_HOST=${EMAIL_HOST}
EMAIL_PORT=${EMAIL_PORT:-587}
EMAIL_USE_TLS=${EMAIL_USE_TLS:-true}
EMAIL_USE_SSL=${EMAIL_USE_SSL:-false}
EMAIL_HOST_USER=${EMAIL_HOST_USER}
EMAIL_HOST_PASSWORD=${EMAIL_HOST_PASSWORD}

# Email Settings
DEFAULT_FROM_EMAIL=${DEFAULT_FROM_EMAIL}
ADMIN_EMAIL=${ADMIN_EMAIL}
SERVER_EMAIL=${DEFAULT_FROM_EMAIL}

# ==============================================================================
# LOGGING CONFIGURATION
# ==============================================================================

# Log Levels
LOG_LEVEL=INFO
DJANGO_LOG_LEVEL=INFO
CELERY_LOG_LEVEL=INFO

# Log Format
LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s

# File Logging
LOG_FILE_ENABLED=true
LOG_FILE_PATH=/data/logs/anthias.log
LOG_FILE_MAX_SIZE=10485760  # 10MB
LOG_FILE_BACKUP_COUNT=10

# Database Query Logging (Disabled in Production)
LOG_DATABASE_QUERIES=false

# ==============================================================================
# MONITORING & PERFORMANCE
# ==============================================================================

# Health Check Settings
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_DATABASE=true
HEALTH_CHECK_REDIS=true
HEALTH_CHECK_CELERY=true

# Performance Monitoring
APM_ENABLED=${APM_ENABLED:-false}
APM_SERVICE_NAME=anthias-saas
APM_ENVIRONMENT=production

# Sentry Configuration (Optional)
SENTRY_DSN=${SENTRY_DSN}
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_ENVIRONMENT=production

# ==============================================================================
# CACHING CONFIGURATION
# ==============================================================================

# Cache Backend
CACHE_BACKEND=redis
CACHE_LOCATION=redis://${REDIS_HOST}:${REDIS_PORT}/2

# Cache Timeouts (Production Optimized)
CACHE_DEFAULT_TIMEOUT=600
CACHE_VIEW_TIMEOUT=1800
CACHE_TEMPLATE_TIMEOUT=7200

# Session Cache
SESSION_ENGINE=django.contrib.sessions.backends.cache
SESSION_CACHE_ALIAS=default

# ==============================================================================
# BACKUP & DISASTER RECOVERY
# ==============================================================================

# Backup Configuration
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_STORAGE_PATH=/data/backups

# Database Backup
DB_BACKUP_ENABLED=true
DB_BACKUP_COMPRESSION=gzip

# Media Backup
MEDIA_BACKUP_ENABLED=true
MEDIA_BACKUP_EXCLUDE_PATTERNS=*.tmp,*.log,*.cache

# Cloud Backup (Optional)
AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
AWS_STORAGE_BUCKET_NAME=${AWS_STORAGE_BUCKET_NAME}
AWS_S3_REGION_NAME=${AWS_S3_REGION_NAME:-us-east-1}

# ==============================================================================
# DOCKER & INFRASTRUCTURE
# ==============================================================================

# Docker Image Configuration
IMAGE_TAG=${IMAGE_TAG:-latest}
DEBIAN_VERSION=bookworm
PYTHON_VERSION=3.11
NODE_VERSION=22
NGINX_VERSION=alpine

# Network Configuration
FRONTEND_SUBNET=172.20.0.0/16
BACKEND_SUBNET=172.21.0.0/16

# Volume Paths
POSTGRES_DATA_PATH=./data/postgres
REDIS_DATA_PATH=./data/redis
ANTHIAS_DATA_PATH=./data/anthias
STATIC_FILES_PATH=./data/static
MEDIA_FILES_PATH=./data/media
BACKUP_FILES_PATH=./data/backups
LOG_FILES_PATH=./data/logs
SSL_CERTS_PATH=./data/ssl/certs
SSL_PRIVATE_PATH=./data/ssl/private

# ==============================================================================
# BUILD INFORMATION
# ==============================================================================

# Git Information (Populated by CI/CD)
GIT_HASH=${GIT_HASH:-unknown}
GIT_SHORT_HASH=${GIT_SHORT_HASH:-unknown}
GIT_BRANCH=${GIT_BRANCH:-main}
GIT_TAG=${GIT_TAG}
BUILD_NUMBER=${BUILD_NUMBER:-0}
BUILD_DATE=${BUILD_DATE}

# Device Information
DEVICE_TYPE=server
DEVICE_ID=anthias-production

# ==============================================================================
# FEATURE FLAGS
# ==============================================================================

# Core Features
ENABLE_USER_REGISTRATION=true
ENABLE_MULTI_TENANT=true
ENABLE_API_VERSIONING=true
ENABLE_RATE_LIMITING=true
ENABLE_AUDIT_LOGGING=true

# Advanced Features
ENABLE_REAL_TIME_UPDATES=true
ENABLE_ADVANCED_SCHEDULING=true
ENABLE_CONTENT_ANALYTICS=true

# ==============================================================================
# API CONFIGURATION
# ==============================================================================

# API Settings
API_VERSION=v1
API_PAGINATION_SIZE=20
API_MAX_PAGE_SIZE=100

# Rate Limiting (Production Settings)
API_RATE_LIMIT=1000/hour
API_BURST_LIMIT=100/minute

# API Documentation
API_DOCS_ENABLED=${API_DOCS_ENABLED:-false}  # Disable in production
API_DOCS_URL=/api/docs/

# ==============================================================================
# FRONTEND CONFIGURATION
# ==============================================================================

# Next.js Frontend Settings
NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL}
NEXT_PUBLIC_WS_URL=${NEXT_PUBLIC_WS_URL}
NEXTAUTH_URL=${NEXTAUTH_URL}
NEXTAUTH_SECRET=${NEXTAUTH_SECRET}

# ==============================================================================
# THIRD-PARTY INTEGRATIONS
# ==============================================================================

# CDN Configuration
CDN_ENABLED=${CDN_ENABLED:-false}
CDN_URL=${CDN_URL}

# Analytics
GOOGLE_ANALYTICS_ID=${GOOGLE_ANALYTICS_ID}
MATOMO_SITE_ID=${MATOMO_SITE_ID}
MATOMO_URL=${MATOMO_URL}

# ==============================================================================
# NOTIFICATION SETTINGS
# ==============================================================================

# Slack Integration
SLACK_WEBHOOK_URL=${SLACK_WEBHOOK_URL}

# Discord Integration
DISCORD_WEBHOOK_URL=${DISCORD_WEBHOOK_URL}

# ==============================================================================
# SECURITY SCANNING
# ==============================================================================

# Security Headers
X_FRAME_OPTIONS=DENY
X_CONTENT_TYPE_OPTIONS=nosniff
X_XSS_PROTECTION=1; mode=block
REFERRER_POLICY=strict-origin-when-cross-origin

# Content Security Policy
CSP_DEFAULT_SRC="'self'"
CSP_SCRIPT_SRC="'self' 'unsafe-inline' 'unsafe-eval'"
CSP_STYLE_SRC="'self' 'unsafe-inline'"
CSP_IMG_SRC="'self' data: https:"